# 🚀 MindFlow 运行指南

## 步骤 1: 检查必要文件

确保以下文件已存在：
- ✅ `lib/p5.min.js` - p5.js 库文件
- ✅ `icons/icon16.png` - 16x16 图标
- ✅ `icons/icon48.png` - 48x48 图标
- ✅ `icons/icon128.png` - 128x128 图标（如果缺失，可以复制 icon48.png 并重命名）

## 步骤 2: 在 Chrome 中加载扩展

### 2.1 打开扩展管理页面
1. 打开 **Google Chrome** 浏览器
2. 在地址栏输入：`chrome://extensions/`
3. 按回车键

### 2.2 启用开发者模式
1. 在页面右上角找到 **「开发者模式」** 开关
2. 点击开关，使其变为 **蓝色/开启状态**

### 2.3 加载扩展
1. 点击页面左上角的 **「加载已解压的扩展程序」** 按钮
2. 在弹出的文件选择对话框中，导航到项目文件夹：
   ```
   E:\MindFlow
   ```
3. 选择该文件夹，点击 **「选择文件夹」**

### 2.4 验证安装
- ✅ 扩展列表中应出现 **"MindFlow"**
- ✅ 浏览器工具栏应显示 MindFlow 图标
- ✅ 图标上可能显示数字（当前 DSI 值）

## 步骤 3: 测试插件

### 3.1 访问测试网页
1. 打开任意网页（如：`https://www.example.com`）
2. 观察浏览器工具栏上的 MindFlow 图标
3. 图标上会显示当前页面的 **DSI 数值**（0-100）

### 3.2 触发干预测试

#### 测试 Level 1（柔和模式）
- 快速滚动页面（滚动速度 > 1500px/s）
- 或频繁点击（> 3次/秒）
- 当 DSI > 30 时，页面会应用护眼滤镜效果

#### 测试 Level 2（阅读模式）
- 继续快速浏览，让 DSI > 60
- 页面会显示阅读模式覆盖层，提取正文内容
- 可以点击 **「🤖 AI 生成摘要」** 按钮（需先配置 API Key）

#### 测试 Level 3（视觉疗愈）
- 继续快速浏览，让 DSI > 80
- 会触发全屏 p5.js 流体动画
- 动画持续 5 秒后自动关闭

### 3.3 查看调试信息

#### 查看 Content Script 日志
1. 在任意网页按 `F12` 打开开发者工具
2. 切换到 **Console** 标签
3. 可以看到 MindFlow 的运行日志：
   ```
   [MindFlow] Content script 已加载
   [Monitor] 行为监听已启动
   [Intervention] 收到干预指令: Level 1, DSI: 35.2
   ```

#### 查看 Background Service Worker 日志
1. 访问 `chrome://extensions/`
2. 找到 MindFlow 扩展
3. 点击 **「Service Worker」** 链接（在扩展卡片下方）
4. 在打开的 DevTools 中查看 Console 日志：
   ```
   [MindFlow] Background Service Worker 已启动
   [DSI] 级别变化: 0 -> 1, DSI: 32.5
   [Intervention] 已发送 Level 1 干预指令到标签页 123
   ```

## 步骤 4: 配置 AI 摘要功能（可选）

如果需要使用 Level 2 的 AI 摘要功能：

1. 打开任意网页，按 `F12` 打开开发者工具
2. 切换到 **Console** 标签
3. 执行以下代码（替换为你的 API Key）：

```javascript
chrome.storage.local.set({
  apiKey: 'sk-your-openai-api-key-here',
  apiEndpoint: 'https://api.openai.com/v1/chat/completions'
});
```

4. 在阅读模式中点击 **「🤖 AI 生成摘要」** 按钮即可使用

## 常见问题

### ❌ 扩展加载失败
- **问题**：提示 "无法加载扩展程序"
- **解决**：检查 `manifest.json` 语法是否正确，确保所有引用的文件都存在

### ❌ 图标不显示
- **问题**：工具栏图标显示为灰色方块
- **解决**：确保 `icons/` 目录下有 `icon16.png`、`icon48.png`、`icon128.png` 三个文件

### ❌ p5.js 未加载
- **问题**：Level 3 视觉疗愈动画不显示
- **解决**：检查 `lib/p5.min.js` 文件是否存在且完整

### ❌ DSI 不更新
- **问题**：图标上的数字始终为 0
- **解决**：
  1. 检查 Service Worker 是否正常运行
  2. 在网页上尝试滚动和点击
  3. 查看 Console 是否有错误信息

### ❌ 干预不触发
- **问题**：DSI 很高但干预不生效
- **解决**：
  1. 检查 Console 是否有错误
  2. 确认 content.js 已正确注入（查看 Console 是否有 `[MindFlow] Content script 已加载`）
  3. 检查 Service Worker 日志

## 快速测试命令

在网页 Console 中执行以下命令进行测试：

```javascript
// 查看当前 DSI 状态
chrome.runtime.sendMessage({ type: 'GET_DSI' }, (response) => {
  console.log('当前 DSI:', response);
});

// 重置 DSI（用于重新测试）
chrome.runtime.sendMessage({ type: 'RESET_DSI' }, () => {
  console.log('DSI 已重置');
});
```

---

**🎉 现在你可以开始使用 MindFlow 了！**

访问任意网页，开始浏览，插件会自动监测你的行为并适时提供视觉解压干预。

